{% extends 'base.html' %}

{% block body %}
<h2>Search</h2>
    {% if content.results %}
    <h3>Results</h3>

    {% for facet, values in content.facets.fields.items %}
        <p>{{ facet }}</p>
        <ul>
            {% for name, count in values %}
                <li><a class="facet-link" href="#" data-facet-name="{{ facet }}" data-facet-value="{{ name }}">{{ name }} </a> ({{ count }})</li>
            {% endfor %}
        </ul>
    {% endfor %}

    {% for result in content.results %}
    <p>
        <a href="{{ result.url }}">{{ result.title }}</a>
    </p>
    {% empty %}
    <p>No results found.</p>
    {% endfor %}

    {% endif %}
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    // this code manages what happens when a facet link is clicked.
    $(".facet-link").on('click', function(event)
    {
        var qstr = window.location.search.replace("?", "");
        var qstr_params = $.parseParams(qstr);
        var facetName = $(this).data('facet-name');
        var facetValue = $(this).data('facet-value');
        if (!(facetName in qstr_params))
        {
            var facetQ = facetName + "=" + facetValue;
            if (qstr != "")
            {
                // this makes sure that we either append the
                // querystring to an existing query string
                // (with a "&") or we just append it to the
                // existing URL.
                facetQ = "&" + facetQ;
            }
            window.location.search = qstr + facetQ;
        }
        event.preventDefault();
    });
</script>
{% endblock %}

