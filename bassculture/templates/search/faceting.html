{% load tags %}
{% load staticfiles %}

        <h4>Search within the results</h4>



    <form role = "form" id="filter" data-facet-offset="{{ content.params.start }}" data-facet-limit="{{ content.limit }}" action="/fiddle/search/" method="get">
        {% if request.GET.q == '*' %}
        <input type="hidden" name="q" value="*" />
        {% endif %}
    <div class="input-group">
        <input type="text" name="fq" id="fq" class="form-control" placeholder="Filter for...">
        <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go!</button>
        </span>
    </div>
    </form>

    <br />


{% for facet, values in content.facets.items %}

    {% if facet == 'source_title' %}
        {% if values|length > 1 %}
        <h4><i class="fa fa-book fa-fw"></i>&nbsp; Filter by source title</h4>
        <ul>
            {% for name, count in values %}
                <li><a class="facet-link" href="#" data-facet-name="{{ facet }}" data-facet-value="{{ name|urlencode|iriencode }}" data-facet-offset="{{ facet }}" data-facet-offset="{{ content.params.start }}" data-facet-limit="{{ content.limit }}">{{ name }} </a> ({{ count }})</li>
            {% endfor %}
        </ul>
        {% endif %}
    {% endif %}


    {% if facet == 'author' %}
        {% if values|length > 1 %}
        <h4><i class="fa fa-user"></i>&nbsp; Filter by source author (in all the sources)</h4>

        <ul>
            {% for name, count in values %}
                <li><a class="facet-link" href="#" data-facet-name="{{ facet }}" data-facet-value="{{ name|urlencode|iriencode }}" data-facet-offset="{{ content.params.start }}" data-facet-limit="{{ content.limit }}">{{ name }} </a> ({{ count }})</span></li>
            {% endfor %}
        </ul>
        {% endif %}
    {% endif %}


{% endfor %}
</div>

{% block scripts %}

<script src="{% static 'js/jquery.min.js' %}" type="text/javascript"></script>

<script type="text/javascript">

$(document).ready(function() {
    $("#filter").submit(function(event) {
        event.preventDefault();       
        $this = $(this);
        var fq = $('#fq').val();
        var facetOffset = $(this).data('facet-offset');
        var facetLimit = $(this).data('facet-limit');
        var qstr = window.location.search.replace("?limit=10" + "&offset=" + facetOffset + "&", "");
        var qstr = window.location.search.replace("&limit=" + facetLimit + "&offset=" + facetOffset, "");
        if (qstr.includes('fq=')) {
            var url = qstr + '&' + fq;
        } else {
            var url = qstr + '&fq=' + fq;
        };
        window.location.search = url;
    });
});

</script>
{% endblock %}