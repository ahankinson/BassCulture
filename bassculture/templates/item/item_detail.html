{% extends "base.html" %}
{% load staticfiles %}

{% block title %}
<title>Bass Culture | {{ content.short_title }}</title>
{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'css/diva.min.css' %}">
{% endblock %}

{% block body %}
<div class="container-fluidit">

<div class="col-md-12">

    <h2 class="text-center"><em>{{ content.source_title }}</em><br /><small> by {{ content.source_author }}</small></h2>
<br />
</div>

<div class="cont">
    <div class="row">
        <div class="col-sm-6 sp editor">
            <div class="inner" id="itemDetails" style="height: 858px; overflow: scroll;">

  <ul class="nav nav-tabs">
    <li class="active"><a href="#tunes-list">Tunes list</a></li>
    <li><a href="#copy-detail">Copy detail</a></li>
  </ul>

  <div class="tab-content">
    <div id="tunes-list" class="tab-pane fade in active">
      <h3>Tunes list</h3>
            {% if content.id == 1 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page }}" data-w="200" data-h="200" data-y="20" data-x="20">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-10" }})</li>
                {% endfor %}
            {% elif content.id == 2 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"5" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"0" }})</li>
                {% endfor %}
            {% elif content.id == 3 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-14" }})</li>
                {% endfor %}
            {% elif content.id == 4 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-6" }})</li>
                {% endfor %}
            {% elif content.id == 5 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"8" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-2" }})</li>
                {% endfor %}
            {% elif content.id == 6 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"4" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-1" }})</li>
                {% endfor %}
            {% elif content.id == 7 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"1" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-2" }})</li>
                {% endfor %}
            {% elif content.id == 8 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"-124" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-126" }})</li>
                {% endfor %}
            {% elif content.id == 9 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"2" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-4" }})</li>
                {% endfor %}
            {% elif content.id == 10 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-6" }})</li>
                {% endfor %}
            {% elif content.id == 11 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"2" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-1" }})</li>
                {% endfor %}
            {% elif content.id == 12 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"3" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-1" }})</li>
                {% endfor %}
            {% elif content.id == 13 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"-40" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-42" }})</li>
                {% endfor %}
            {% elif content.id == 14 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"2" }}">{{ tune.name|title }}</a> (p. {{ tune.start_page|add:"-4" }})</li>
                {% endfor %}
            {% elif content.id == 15 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"7" }}">{{ tune.name|title }}</a> (p. {{ tune.start_page|add:"-3" }})</li>
                {% endfor %}
            {% elif content.id == 16 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"-3" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-6" }})</li>
                {% endfor %}
            {% elif content.id == 17 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"2" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-2" }})</li>
                {% endfor %}
            {% elif content.id == 18 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"1" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-2" }})</li>
                {% endfor %}
            {% elif content.id == 19 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"1" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-1" }})</li>
                {% endfor %}
            {% elif content.id == 20 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"2" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-4" }})</li>
                {% endfor %}
            {% elif content.id == 21 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-1" }})</li>
                {% endfor %}
            {% elif content.id == 22 %}
                {% for tune in content.tunes|dictsort:"start_page" %}
                <li><a href="#" class="tune-page-link" data-page="{{ tune.start_page|add:"0" }}">{{ tune.name }}</a> (p. {{ tune.start_page|add:"-16" }})</li>
                {% endfor %}
            {% endif %}
    </div><!--tunes-list-->
    
    <div id="copy-detail" class="tab-pane fade">
      <h3>Copy details</h3>
      <br />
<!--                 <div class="panel-body"> -->

                    {% if content.seller %}

                        <h4>Seller</h4>
                        <p>{{ content.seller }}</p>

                    {% endif %}

                    {% if content.item_notes %}

                        <h4>Item notes</h4>
                        <p>{{ content.item_notes }}</p>

                    {% endif %}

                    <h4>Publisher</h4>
                    <p>{{ content.source_publisher }}</p>

                    {% if content.source_printer %}

                        <h4>Printer</h4>
                        <p>{{ content.source_printer }}</p>

                    {% endif %}

                    <h4>Date</h4>
                    <p>{{ content.source_date }}</p>

                    {% if content.source_rism%}

                        <h4>RISM</h4>
                        <p>{{ content.source_rism }}</p>

                    {% endif %}

                    <h4>Pagination</h4>
                    <p>{{ content.pagination }}</p>

                    {% if content.source_orientation %}

                        <h4>Orientation</h4>
                        <p>{{ content.source_orientation }}</p>

                    {% endif %}

                    {% if content.dimensions %}

                        <h4>Dimensions</h4>
                        <p>{{ content.dimensions }}</p>

                    {% endif %}

                    <h4>Shelfmark</h4>
                    <p>{{ content.shelfmark }}</p>

                    <h4>Library</h4>
                    <p>{{ content.library }}</p>

                    <h4>Edition</h4>
                    <p>{{ content.source_edition }}</p>

                    {% if content.source_gore%}

                        <h4>Gore</h4>
                        <p>{{ content.source_gore }}</p>

                    {% endif %}


</div><!--copy-detail-->
</div><!--tab-content-->
</div><!--inner-->
</div><!--sp editor-->
        
        <div class="col-sm-6 sp">
            <div class="inner" id="diva-wrapper"></div>
        </div>
        
    </div> <!--row-->
</div> <!--cont-->

    <div class="col-md-12">

        <br />
        <br />

    </div>

</div> <!--container-fluid-->

{% endblock %}

{% block scripts %}
    <script src="{% static 'js/diva.min.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'js/bassculture.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        $('#diva-wrapper').diva({
            enableAutoHeight: true,
            fixedHeightGrid: false,
            enableAutoTitle: false,
            iipServerURL: "{{ IIP_SERVER }}",
            objectData: "{{ DIVA_OBJECT_DATA }}" + "{{ content.id }}.json",
            imageDir: "{{ IIP_SERVER_IMAGE_PATH }}" + "{{ content.id }}",
            enableCanvas: false,
            enableDownload: true,
            blockMobileMove: false,
            enableZoomControls: 'buttons',
            inBookLayout: false,
            zoomLevel: 2,
            enableHighlight: false
        });
    </script>
    <script type="text/javascript">

            var divaObject = $('#diva-wrapper').data('diva')
            diva.Events.subscribe('DocumentDidLoad', function(idx, filename) {
                if(sessionStorage.gotoPage) {
                divaObject.gotoPageByNumber(sessionStorage.gotoPage);
            }
        });
                
        $('.tune-page-link').click(function(e)
        {
            var diva = $('#diva-wrapper').data('diva');
            var pageNum = $(this).data('page');
            diva.gotoPageByNumber(pageNum);
            e.preventDefault();
                regions = [{
                    'width': $(this).data('w'),
                    'height': $(this).data('h'),
                    'ulx': $(this).data('x'),
                    'uly': $(this).data('y'),
                }];
            diva.highlightOnPage(pageNum-1, regions);
        });
    </script>
    <script>
        $(document).ready(function(){
            $(".nav-tabs a").click(function(){
                $(this).tab('show');
            });
            $('.nav-tabs a').on('shown.bs.tab', function(event){
                var x = $(event.target).text();         // active tab
                var y = $(event.relatedTarget).text();  // previous tab
                $(".act span").text(x);
                $(".prev span").text(y);
            });
        });
    </script>
    <script src="{% static 'js/verovio-toolkit.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        var vrvToolkit = new verovio.toolkit();
        $.get('{{ tune.mei_file }}', function (data)
        {
            var svg = vrvToolkit.renderData( data + "\n", "" );
            $("#notation").html(svg);
        }, 'text');

    </script>
    <script>
	$(window).bind("resize", function(event){
  		if (this == event.target) {
			$('.sp').removeAttr('style');
    	}
	});

	$('.editor').resizable({
    	handles: 'e, s',
		minWidth:100,
  		maxWidth:900,
  		resize:function(event,ui){
    		var x=ui.element.outerWidth();
    		var y=ui.element.outerHeight();
    		var ele=ui.element;
     		var factor = $(this).parent().width()-x;
      		var f2 = $(this).parent().width() * .02999;
      		console.log(f2);
      		$.each(ele.siblings(),function(idx,item){
          
        		ele.siblings().eq(idx).css('height',y+'px');
          		//ele.siblings().eq(idx).css('width',(factor-41)+'px');
        		ele.siblings().eq(idx).width((factor-f2)+'px');

      		});
    	}
	});

	$('.sp:not(.editor)').resizable({
    	handles: 's',
  		resize:function(event,ui){
    	
    		var y=ui.element.outerHeight();
    		var ele=ui.element;
     	
      		$.each(ele.siblings(),function(idx,item){
        		ele.siblings().eq(idx).css('height',y+'px');
      		});
    	}
	});
    </script>
{% endblock %}